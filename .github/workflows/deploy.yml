# =====================================================================
# ğŸš€ DEPLOY WEB APPLICATION WORKFLOW
# =====================================================================
name: ğŸš€ Deploy Web Application

# ---------------------------------------------------------------------
# ğŸ“‹ WORKFLOW TRIGGERS
# ---------------------------------------------------------------------
on:
  workflow_dispatch: # ğŸ‘† Allow manual triggering
  release:
    types: [published] # ğŸ“¦ Run when a new release is published

# ---------------------------------------------------------------------
# ğŸ’¼ JOBS
# ---------------------------------------------------------------------
jobs:
  deploy:
    name: ğŸ”„ Deploy Application
    runs-on: ubuntu-latest
    timeout-minutes: 15 # â±ï¸ Set a timeout to prevent long-running jobs

    steps:
      # ğŸ“¥ CHECKOUT
      - name: ğŸ“¥ Checkout repository code
        uses: actions/checkout@v5.0.0

      # ğŸ› ï¸ SETUP ENVIRONMENT
      - name: ğŸ”§ Install Foundry
        uses: foundry-rs/foundry-toolchain@v1.5.0
        with:
          version: nightly

      - name: ğŸ“¦ Install pnpm
        uses: pnpm/action-setup@v4.2.0
        with:
          run_install: false

      - name: ğŸŸ¢ Install Node.js
        uses: actions/setup-node@v5
        with:
          cache: "pnpm"
          node-version-file: "package.json"

      # ğŸ“š DEPENDENCIES
      - name: ğŸ“š Install dependencies
        run: pnpm install

      # ğŸ—ï¸ BUILD
      - name: ğŸ—ï¸ Build the apps and packages
        run: pnpm run build

      # ğŸ§ª TEST
      - name: ğŸ§ª Execute tests
        run: pnpm run test

      # ğŸš€ DEPLOY
      - name: ğŸš€ Deploy to pinme
        run: cd ./apps/web/ && pnpm pinme upload dist
